<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCOR (Kirsch Cumulative Outcomes Ratio) - Visual Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin-top: 40px;
        }
        h3 {
            color: #2980b9;
            margin-top: 30px;
        }
        .overview-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .key-innovation {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        .methodology-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .step-card {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #3498db;
        }
        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .plot-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .plot-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .plot-container img:hover {
            transform: scale(1.02);
        }
        .formula-box {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .key-features {
            background-color: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
        }
        .key-features ul {
            margin: 0;
            padding-left: 20px;
        }
        .mathematical-advantage {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .results-table th, .results-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        .results-table th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .limitations, .advantages {
            padding: 20px;
            border-radius: 8px;
        }
        .limitations {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .advantages {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
        }
        .limitations ul li, .advantages ul li {
            margin: 8px 0;
        }
        .validation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .validation-item {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #3498db;
        }
        .conclusion-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
        }
        .footer-info {
            background-color: #34495e;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
        }
        code {
            background-color: #f1f1f1;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .kcor-interpretation {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .interpretation-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        .neutral { background-color: #f8f9fa; border: 2px solid #6c757d; }
        .harmful { background-color: #f8d7da; border: 2px solid #dc3545; }
        .protective { background-color: #d4edda; border: 2px solid #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <h1>KCOR (Kirsch Cumulative Outcomes Ratio)<br>Visual Guide</h1>
        
        <div class="overview-box">
            <h2 style="color: white; border: none; margin-top: 0;">Overview</h2>
            <p>KCOR (Kirsch Cumulative Outcomes Ratio) is a statistical method that enables objective analysis of whether a medical intervention (like vaccination) was beneficial or harmful by comparing mortality rates between different cohorts while accounting for underlying mortality trends.</p>
        </div>

        <div class="key-innovation">
            <strong>Key Innovation</strong>: KCOR normalizes baseline mortality rates so that if there is no differential signal applied to either cohort, both would die at identical rates over time. This creates a "virtual randomization" from observational data.
        </div>

        <h2>Methodology Flowchart</h2>
        <div class="plot-container">
            <img src="KCOR_methodology_flowchart.png" alt="KCOR Methodology Flowchart" />
        </div>

        <div class="methodology-steps">
            <div class="step-card">
                <div class="step-number">1</div>
                <h3 style="margin: 0; color: #3498db;">Smoothing</h3>
                <p>Apply 8-week centered moving average to reduce noise</p>
            </div>
            <div class="step-card">
                <div class="step-number">2</div>
                <h3 style="margin: 0; color: #3498db;">Slope Adjustment</h3>
                <p>Normalize for baseline mortality trends</p>
            </div>
            <div class="step-card">
                <div class="step-number">3</div>
                <h3 style="margin: 0; color: #3498db;">Hazard Transform</h3>
                <p>Convert to discrete hazard functions for mathematical exactness</p>
            </div>
            <div class="step-card">
                <div class="step-number">4</div>
                <h3 style="margin: 0; color: #3498db;">KCOR Calculation</h3>
                <p>Compute ratio of cumulative hazards with baseline normalization</p>
            </div>
        </div>

        <h2>Step-by-Step Visual Illustration</h2>

        <h3>Step 1: Data Smoothing</h3>
        <div class="plot-container">
            <img src="KCOR_step1_smoothing.png" alt="Step 1: Smoothing" />
        </div>
        <p><strong>Purpose</strong>: Reduce noise in raw mortality data while preserving underlying trends.</p>
        <p><strong>Method</strong>: 8-week centered moving average is applied to both vaccinated and unvaccinated cohorts.</p>
        <div class="key-features">
            <strong>Key Features</strong>:
            <ul>
                <li>Raw mortality rates (dotted lines) show significant week-to-week variability</li>
                <li>Smoothed rates (solid lines) reveal underlying patterns</li>
                <li>Anchor points (red dashed lines) are identified for slope calculation during quiet periods</li>
            </ul>
        </div>

        <h3>Step 2: Slope Normalization</h3>
        <div class="plot-container">
            <img src="KCOR_step2_slope_normalization.png" alt="Step 2: Slope Normalization" />
        </div>
        <p><strong>Purpose</strong>: Adjust for baseline differences in mortality trends between cohorts.</p>
        <div class="formula-box">
            <strong>Formula</strong>: MR_adj(t) = MR(t) × exp(-r(t - t₀))
        </div>
        <p><strong>Where</strong>:</p>
        <ul>
            <li><code>MR_adj(t)</code> = Adjusted mortality rate at time t</li>
            <li><code>MR(t)</code> = Original smoothed mortality rate</li>
            <li><code>r</code> = Calculated slope from anchor points</li>
            <li><code>t₀</code> = Enrollment week (t₀ = 0)</li>
        </ul>
        <div class="key-innovation">
            <strong>Key Insight</strong>: This step creates cohorts that would have identical mortality trends in the absence of any differential intervention effects.
        </div>

        <h3>Step 3: Discrete Hazard Function Transform</h3>
        <div class="plot-container">
            <img src="KCOR_step3_hazard_transform.png" alt="Step 3: Hazard Transform" />
        </div>
        <p><strong>Purpose</strong>: Convert mortality rates to discrete hazard functions for mathematical exactness.</p>
        <div class="formula-box">
            <strong>Formula</strong>: hazard(t) = -ln(1 - MR_adj(t))
        </div>
        <div class="mathematical-advantage">
            <strong>Mathematical Advantage</strong>:
            <ul>
                <li>Hazard functions provide more accurate representation of instantaneous risk</li>
                <li>Enable precise cumulative hazard calculations</li>
                <li>Account for the fact that people can only die once</li>
            </ul>
        </div>
        <p><strong>Visual Comparison</strong>: The plots show both the adjusted mortality rates and their corresponding discrete hazard transformations.</p>

        <h3>Step 4: Cumulative Hazards and KCOR</h3>
        <div class="plot-container">
            <img src="KCOR_step4_cumulative_hazard_kcor.png" alt="Step 4: KCOR Calculation" />
        </div>
        <p><strong>Purpose</strong>: Calculate the cumulative risk difference between cohorts over time.</p>
        <div class="formula-box">
            <strong>Formulas</strong>:<br>
            • Cumulative Hazard: CH(t) = Σ hazard(i) for i=0 to t<br>
            • KCOR: KCOR(t) = [CH_vax(t)/CH_unvax(t)] / [CH_vax(t₀)/CH_unvax(t₀)]
        </div>
        <p><strong>Baseline Normalization</strong>: KCOR is normalized to 1.0 at week 4 (orange dashed line):</p>
        <div class="kcor-interpretation">
            <div class="interpretation-card neutral">KCOR = 1.0<br>No difference between groups</div>
            <div class="interpretation-card harmful">KCOR > 1.0<br>Higher mortality risk in vaccinated group</div>
            <div class="interpretation-card protective">KCOR < 1.0<br>Lower mortality risk in vaccinated group</div>
        </div>

        <h2>Complete Methodology Illustration</h2>
        <div class="plot-container">
            <img src="KCOR_complete_methodology_illustration.png" alt="Complete KCOR Illustration" />
        </div>
        <p>This comprehensive view shows all four steps of the KCOR methodology side-by-side, demonstrating how raw mortality data is transformed into the final KCOR risk assessment.</p>

        <h2>Key Mathematical Formulations</h2>

        <h3>1. Slope Calculation (Geometric Mean Method)</h3>
        <p>The slope is calculated using anchor points during "quiet periods" (minimal differential events):</p>
        <div class="formula-box">
            r = (1/Δt) × ln(B̃/Ã)
        </div>
        <p><strong>Where</strong>:</p>
        <ul>
            <li>Ã = Geometric mean of mortality rates around first anchor point</li>
            <li>B̃ = Geometric mean of mortality rates around second anchor point</li>
            <li>Δt = Time difference between anchor points</li>
        </ul>

        <h3>2. Slope Adjustment</h3>
        <p>Mortality rates are adjusted for baseline trends:</p>
        <div class="formula-box">
            MR_adj(t) = MR(t) × exp(-r(t - t₀))
        </div>

        <h3>3. Discrete Hazard Transform</h3>
        <p>Conversion to hazard functions for mathematical precision:</p>
        <div class="formula-box">
            hazard(t) = -ln(1 - MR_adj(t))
        </div>

        <h3>4. KCOR Calculation</h3>
        <p>Final ratio computation with baseline normalization:</p>
        <div class="formula-box">
            KCOR(t) = [CH_vax(t)/CH_unvax(t)] / [CH_vax(4)/CH_unvax(4)]
        </div>

        <h2>Statistical Interpretation</h2>

        <h3>KCOR Values Mean</h3>
        <div class="kcor-interpretation">
            <div class="interpretation-card neutral"><strong>KCOR = 1.000</strong><br>No difference in mortality risk between groups</div>
            <div class="interpretation-card harmful"><strong>KCOR = 1.250</strong><br>25% higher mortality risk in vaccinated group</div>
            <div class="interpretation-card protective"><strong>KCOR = 0.800</strong><br>20% lower mortality risk in vaccinated group (protective effect)</div>
        </div>

        <h3>Confidence Intervals</h3>
        <p>KCOR includes 95% confidence intervals calculated using proper uncertainty propagation:</p>
        <div class="formula-box">
            Var[ln(KCOR(t))] = Var[CH_vax(t)]/CH_vax(t)² + Var[CH_unvax(t)]/CH_unvax(t)² + baseline terms
        </div>

        <h2>Real-World Application: Czech Data Results</h2>
        <p>When applied to the Czech Republic's comprehensive vaccination and mortality dataset, KCOR revealed:</p>

        <table class="results-table">
            <thead>
                <tr>
                    <th>Dose Level</th>
                    <th>KCOR Value</th>
                    <th>95% CI</th>
                    <th>Interpretation</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1 vs 0</td>
                    <td>1.052</td>
                    <td>[1.022, 1.082]</td>
                    <td>5.2% increased mortality risk</td>
                </tr>
                <tr>
                    <td>2 vs 0</td>
                    <td>1.258</td>
                    <td>[1.232, 1.285]</td>
                    <td>25.8% increased mortality risk</td>
                </tr>
                <tr>
                    <td>3 vs 0</td>
                    <td>1.549</td>
                    <td>[1.518, 1.580]</td>
                    <td>54.9% increased mortality risk</td>
                </tr>
            </tbody>
        </table>

        <p>These results demonstrate a <strong>dose-dependent accelerating mortality pattern</strong>, providing evidence of cumulative vaccine toxicity.</p>

        <h2>Why KCOR is Superior to Traditional Methods</h2>

        <div class="comparison-grid">
            <div class="limitations">
                <h3>Traditional Epidemiological Limitations</h3>
                <ul>
                    <li>❌ Assume static baseline rates</li>
                    <li>❌ Don't account for time-varying trends</li>
                    <li>❌ Require complex matching or adjustment</li>
                    <li>❌ Vulnerable to confounding and bias</li>
                </ul>
            </div>
            <div class="advantages">
                <h3>KCOR Advantages</h3>
                <ul>
                    <li>✅ Dynamic slope correction for time-varying trends</li>
                    <li>✅ Mathematical exactness through discrete hazard functions</li>
                    <li>✅ Baseline normalization creates "virtual randomization"</li>
                    <li>✅ Works with minimal data: birth, death, vaccination dates</li>
                    <li>✅ Objective, unbiased assessment</li>
                </ul>
            </div>
        </div>

        <h2>Validation and Robustness</h2>
        <p>The KCOR methodology has been validated through:</p>

        <div class="validation-grid">
            <div class="validation-item">
                <strong>Independent Methods</strong><br>
                GLM, DS-CMRR, Kaplan-Meier analysis show consistent results
            </div>
            <div class="validation-item">
                <strong>Negative Controls</strong><br>
                Shows no false signals even with cohorts of different age compositions
            </div>
            <div class="validation-item">
                <strong>Sensitivity Analysis</strong><br>
                Results stable across reasonable parameter variations
            </div>
            <div class="validation-item">
                <strong>Expert Review</strong><br>
                Validated by epidemiologist Harvey Risch (h-index 119)
            </div>
        </div>

        <div class="conclusion-box">
            <h2 style="color: white; border: none; margin-top: 0;">Conclusion</h2>
            <p>KCOR provides a robust, mathematically rigorous method for assessing the net benefit or harm of medical interventions using observational data. Its visual methodology makes the analysis transparent and verifiable, while its statistical foundation ensures accurate risk assessment.</p>
            <p>The method's ability to create "virtual randomization" from observational data represents a significant advance in epidemiological methodology, particularly for answering policy-relevant questions about intervention safety and efficacy.</p>
        </div>

        <div class="footer-info">
            <p><strong>Generated with</strong>: R version 4.3.3, ggplot2, gridExtra, dplyr, cowplot</p>
            <p><strong>Simulation Parameters</strong>: 120 weeks, synthetic mortality data with realistic vaccine effects</p>
            <p><strong>Final Simulated KCOR</strong>: 1.0502 (5.0% increased mortality risk)</p>
        </div>
    </div>
</body>
</html>